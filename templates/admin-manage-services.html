<div>
    <button id="add-service-btn" onclick="addService()">Add Service</button>
</div>
<div id="add-service-form" style="display: none;">
    <form action="/admin-save-service" method="post">
        <label for="title">Title</label>
        <input type="text" id="title" name="title">
        <br>
        <label for="description">Description</label>
        <textarea name="description" id="description" cols="30" rows="5"></textarea>
        <br>
        <label for="price">Price</label>
        <input type="number" id="price" name="price">
        <br>
        <button type="submit">Save</button>
    </form>
</div>
<div>
    <table>
        <thead>
            <th>
                Service ID
            </th>
            <th>
                Service Title
            </th>
            <th>
                Service Description
            </th>
            <th>
                Service Price
            </th>
            <th>
                Action
            </th>
        </thead>
        <tbody>
            {% for i in services_obj %}
            <tr>
                <td>{{ i.service_id }}</td>
                <td id="default-cell-title-{{ i.service_id }}">{{ i.service_title }}</td>
                <td id="default-cell-description-{{ i.service_id }}">{{ i.service_description }}</td>
                <td id="default-cell-price-{{ i.service_id }}">{{ i.service_price }}</td>
                <td>
                    <label for="editServiceCheckbox{{ i.service_id }}">Edit</label>
                    <input type="checkbox" name="editServiceToggle" id="editServiceCheckbox{{ i.service_id }}" onclick="editServiceToggle({{ i.service_id }})">
                    <a href="#" onclick="deleteService({{ i.service_id }})">Delete</a>
                    <!-- Hidden Cells should be placed here, not nested inside another <td> -->
                    </td>
                </tr>
                <!-- Hidden Cells for each service -->
                <tr id="hidden-row-{{ i.service_id }}" style="display: none;">
                    <td></td>
                    <td><input type="text" id="input-title-{{ i.service_id }}" value="{{ i.service_title }}"></td>
                    <td><input type="text" id="input-description-{{ i.service_id }}" value="{{ i.service_description }}"></td>
                    <td><input type="text" id="input-price-{{ i.service_id }}" value="{{ i.service_price }}"></td>
                    <td><button onclick="editService({{ i.service_id }})">Save</button></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function editService(id){
        user_entry = {};
        var input_fields = [
            document.getElementById(`input-title-${id}`),
            document.getElementById(`input-description-${id}`),
            document.getElementById(`input-price-${id}`),
        ]
        for(let i=0;i<input_fields.length;i++){
            user_entry[input_fields[i].id]= input_fields[i].value
            console.log(user_entry)
        }

        axios.put(`/admin-edit-service/${id}`, user_entry).then(response => {
            location.reload(true);
            console.log(response.data);
        }).catch(error => {
            console.log(error)
        });
    }

    function editServiceToggle(id){
        var checkbox = document.getElementById(`editServiceCheckbox${id}`);
        var hiddenRow = document.getElementById(`hidden-row-${id}`);
        

        if (checkbox.checked){
            // Show the hidden row
            hiddenRow.style.display = "table-row";
        } else {
            // Hide the hidden row
            hiddenRow.style.display = "none";
        }
    }

    function addService(){
        const addServiceForm = document.getElementById("add-service-form");
        const addServiceBtn = document.getElementById("add-service-btn")

        if (addServiceBtn && addServiceForm){
            if(addServiceForm.style.display==="none"){
                addServiceForm.style.display="block";
                addServiceBtn.innerHTML="Hide";
            } else {
                addServiceForm.style.display="none";
                addServiceBtn.innerHTML="Add Service";
            }
        }
    } 

    function deleteService(id){
        if (confirm("Are you sure you want to delete this service?")){
            axios.delete(`/admin-delete-service/${id}`).then(response => {
                if (response.status===200){
                    console.log(response.data.message);
                    location.reload(true);
                } else {
                    console.log("service can't be deleted")
                }
            }).catch(error => {
                console.log(error.message);
                location.reload(true);
            });
        } else {
            
        }
    }

</script>