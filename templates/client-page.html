{% extends "layout.html" %}
{% block body %}
<style>
    body {
      background-color: #f4f3ef;
      color: #333;
      font-family: 'Playfair Display', serif;
    }
    .services-container {
      background-color: #eae7dc;
      padding: 20px;
      border-right: 2px solid #d3c1ae;
    }
    .services-container h2 {
      font-family: 'Playfair Display', serif;
      color: #6b705c;
    }
    .services-container ul {
      list-style-type: none;
      padding: 0;
    }
    .services-container ul li a {
      color: #6b705c;
      text-decoration: none;
      font-size: 1.25rem;
      display: block;
      padding: 10px 0;
      height: fit-content;
    }
    .services-container ul li a:hover {
      color: #3a3a3a;
      text-decoration: underline;
    }
    .content-container {
      padding: 20px;
      background-color: #eae7dc;
    }
    #content-container > div {
      display: none; /* Hide all content by default */
    }
  </style>
  
  <div class="container mt-4">
    <div class="row">
      <div class="col-md-3">
        <div class="services-container" id="client-services">
          <h2>unidentified Dental Information System</h2>
          <ul class="nav flex-column">
            <li class="nav-item"><a href="#" class="nav-link" data-content-id="apointment-scheduling-content">Schedule an Appointment</a></li>
            <li class="nav-item"><a href="#" class="nav-link" data-content-id="doctors-calendar-content">Doctor's Calendar</a></li>
            <li class="nav-item"><a href="#" class="nav-link" data-content-id="medical-history-access-content">Medical History Access</a></li>
          </ul>
        </div>
      </div>
      <div class="col-md-9">
        <div id="content-container">
          <div id="apointment-scheduling-content" class="content-container">
            {% include "patient-registration.html" %}
          </div>
          <div id="doctors-calendar-content" class="content-container">
            {% include "doctors-appointments.html" %}
          </div>
          <div id="medical-history-access-content" class="content-container">
            {% include "medical-history.html" %}
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
    let calendar = null
    function handleCalendarLinkClick(event) {
        event.preventDefault(); // Prevent the link from navigating away
        fetchAndRenderCalendar(); // Call your calendar function
    }
    document.addEventListener('DOMContentLoaded', function(){
        const contentContainer = document.getElementById("content-container");
        const serviceLinks = document.querySelectorAll(".services-container ul li a");
        serviceLinks.forEach(link => {
            link.addEventListener("click", function (e) {
                e.preventDefault();
                const contentId = link.getAttribute("data-content-id");
                displayContent(contentId);
            });
        });

        function displayContent(contentId) {
            // Hide all content elements
            document.querySelectorAll("#content-container > div").forEach(content => {
                content.style.display = "none";
            });

            // Display the selected content
            const selectedContent = document.getElementById(contentId);
            selectedContent.style.display = "block";
            if (contentId === 'doctors-calendar-content') {
                fetchAndRenderCalendar(); // This function will render the calendar
            }
        }
        function fetchAndRenderCalendar() {
            var calendarEl = document.getElementById('calendar');
            axios.get('/api/appointments')
            .then(function(response) {
                // Check if the calendar instance already exists
                if (!calendar) {
                    calendar = new FullCalendar.Calendar(calendarEl, {
                        plugins: ['interaction', 'dayGrid', 'timeGrid'],
                        defaultView: 'dayGridMonth',
                        eventRender: function(info) {
                            var date = info.event.start;
                            var currentDate = new Date();
                            if (date.getDate() === currentDate.getDate() &&
                            date.getMonth() === currentDate.getMonth() &&
                            date.getFullYear() === currentDate.getFullYear()) {
                                info.el.style.backgroundColor = 'yellow';
                                info.el.style.color = 'red';
                            }
                        }
                    });
                    calendar.render();
                }

                // Update the events of the existing calendar
                calendar.removeAllEvents(); // Clear existing events
                calendar.addEventSource(response.data); // Add new events
                calendar.refetchEvents(); // Redraw the calendar
                calendar.updateSize(); // Update the calendar size

                console.log('calendar updated');
            })
            .catch(function(error) {
                console.error('Error fetching data:', error);
            });
        }
    });
</script>

{% endblock %}
