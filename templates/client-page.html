{% extends "layout.html" %}
{% block body %}
<div class="services-container" id="client-services">
    <h2>unidentified Dental Information System</h2>
    <ul>
        <li><a href="#" data-content-id="apointment-scheduling-content">Schedule an Appointment</a></li>
        <li><a href="#" data-content-id="doctors-calendar-content">Doctor's Calendar</a></li>
        <li><a href="#" data-content-id="medical-history-access-content">Medical History Access</a></li>
    </ul>
</div>

<div id="content-container">
    <div id="apointment-scheduling-content" style="display: none;">
        {% include "patient-registration.html" %}
    </div>
    <div id="doctors-calendar-content" style="display: none;">
        {% include "doctors-appointments.html" %}
    </div>
    <div id="medical-history-access-content" style="display: none;">
        {% include "medical-history.html" %}
    </div>
</div>

<script>
    let calendar = null
    function handleCalendarLinkClick(event) {
        event.preventDefault(); // Prevent the link from navigating away
        fetchAndRenderCalendar(); // Call your calendar function
    }
    document.addEventListener('DOMContentLoaded', function(){
        const contentContainer = document.getElementById("content-container");
        const serviceLinks = document.querySelectorAll(".services-container ul li a");
        serviceLinks.forEach(link => {
            link.addEventListener("click", function (e) {
                e.preventDefault();
                const contentId = link.getAttribute("data-content-id");
                displayContent(contentId);
            });
        });

        function displayContent(contentId) {
            // Hide all content elements
            document.querySelectorAll("#content-container > div").forEach(content => {
                content.style.display = "none";
            });

            // Display the selected content
            const selectedContent = document.getElementById(contentId);
            selectedContent.style.display = "block";
            if (contentId === 'doctors-calendar-content') {
                fetchAndRenderCalendar(); // This function will render the calendar
            }
        }
        function fetchAndRenderCalendar() {
            var calendarEl = document.getElementById('calendar');
            axios.get('/api/appointments')
            .then(function(response) {
                // Check if the calendar instance already exists
                if (!calendar) {
                    calendar = new FullCalendar.Calendar(calendarEl, {
                        plugins: ['interaction', 'dayGrid', 'timeGrid'],
                        defaultView: 'dayGridMonth',
                        eventRender: function(info) {
                            var date = info.event.start;
                            var currentDate = new Date();
                            if (date.getDate() === currentDate.getDate() &&
                            date.getMonth() === currentDate.getMonth() &&
                            date.getFullYear() === currentDate.getFullYear()) {
                                info.el.style.backgroundColor = 'yellow';
                                info.el.style.color = 'red';
                            }
                        }
                    });
                    calendar.render();
                }

                // Update the events of the existing calendar
                calendar.removeAllEvents(); // Clear existing events
                calendar.addEventSource(response.data); // Add new events
                calendar.refetchEvents(); // Redraw the calendar
                calendar.updateSize(); // Update the calendar size

                console.log('calendar updated');
            })
            .catch(function(error) {
                console.error('Error fetching data:', error);
            });
        }
    });
</script>

{% endblock %}
