<div class="container mt-5">
    <h2>Appointment Management</h2>
    <div class="col-12">
        <div class="row">
            <select id="statusFilter" class="form-select mb-3">
                <option value="" selected disabled>Choose an option</option>
                <option value="all">All Data</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="completed">Completed</option>
            </select>
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <div id="tableContainer">
                    <div class="table-responsive">
                        <table id="allTable" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        {{ i.patient_id }}
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <table id="pending" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in pending_appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        {{ i.patient_id }}
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <table id="approved" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in approved_appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        {{ i.patient_id }}
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <table id="completed" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in completed_appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        {{ i.patient_id }}
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function(){
        const statusFilter = document.getElementById('statusFilter');
        const tableContainer = document.getElementById('tableContainer');
        const allTable = document.getElementById('allTable');
        const pendingTable = document.getElementById('pending');
        const approvedTable = document.getElementById('approved');
        const completedTable = document.getElementById('completed');

        // Add event listener to the status filter dropdown
        statusFilter.addEventListener('change', function() {
            const selectedValue = statusFilter.value;

            // Hide all tables
            allTable.style.display = 'none';
            pendingTable.style.display = 'none';
            approvedTable.style.display = 'none';
            completedTable.style.display = 'none';

            // Show the table based on the selected value
            if (selectedValue === 'all') {
                allTable.style.display = 'table';
            } else if (selectedValue === 'pending') {
                pendingTable.style.display = 'table';
            } else if (selectedValue === 'approved') {
                approvedTable.style.display = 'table';
            } else if (selectedValue === 'completed') {
                completedTable.style.display = 'table';
            }
        });
    
    });
    
    function completeAppointment(id){
        if (confirm("Are you sure you want to complete this appointment?")){
            axios.put(`/admin-complete-appointment/${id}`).then(response => {
                console.log(response.message);
                location.reload(true);
            }).catch(error => {
                console.log(error.message);
            });
        } else {}
    }
    
    function approveAppointment(id){
        if (confirm("Are you sure you want to approve this appointment?")){
            axios.put(`/admin-approve-appointment/${id}`).then(response => {
                console.log(response.message);
                location.reload(true);
            }).catch(error => {
                console.log(error.message);
            });
        } else {}
    }
    
    function deleteAppointment(id){
        if (confirm("Are you sure you want to delete this appointment?")){
            axios.delete(`/admin-delete-appointment/${id}`).then(response => {
                if (response.status===201){
                    console.log(response.data.message);
                }else{
                    console.log(response.data)
                }
                location.reload(true);
            }).catch(error => {
                console.log(error.message);
            });
        } else {}
    }

</script>
