
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8sh+Wy4Ck0AeFWEb5I9pZl/GfEUnLJgT0MqO4" crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js" integrity="sha384-6NEeDZvF6AHdUkKC9J0uU+Q3BQFXNzFT+JAgPuQl4PqriGp/JPhXum0hU1unSWh3" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8sh+Wy4Ck0AeFWEb5I9pZl/GfEUnLJgT0MqO4" crossorigin="anonymous"></script>

<div class="container mt-5">
    <h2>Appointment Management</h2>
    <div class="modal fade" id="patientModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Patient Information</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="patientModalBody">
                    <!-- Display patient information here -->
                </div>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="row">
            <select id="statusFilter" class="form-select mb-3">
                <option value="" selected disabled>Choose an option</option>
                <option value="all">All Data</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="completed">Completed</option>
            </select>
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <div id="tableContainer">
                    <div class="table-responsive">
                        <table id="allTable" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')">{{ i.patient_id }}</a>
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')"><span class="glyphicon glyphicon-eye-open"></span></a>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <table id="pending" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in pending_appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')">{{ i.patient_id }}</a>
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')"><span class="glyphicon glyphicon-eye-open"></span></a>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <table id="approved" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in approved_appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')">{{ i.patient_id }}</a>
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')"><span class="glyphicon glyphicon-eye-open"></span></a>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    
                        <table id="completed" style="display: none;" class="table table-striped table-hover">
                            <thead>
                                <th>
                                    Appointment ID
                                </th>
                                <th>
                                    Patient ID
                                </th>
                                <th>
                                    Admin ID
                                </th>
                                <th>
                                    Appointment Date
                                </th>
                                <th>
                                    Appointment Time
                                </th>
                                <th>
                                    Status
                                </th>
                                <th>
                                    Action
                                </th>
                            </thead>
                            <tbody>
                                {% for i in completed_appointments_obj %}
                                <tr>
                                    <td>
                                        {{ i.appointment_id }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')">{{ i.patient_id }}</a>
                                    </td>
                                    <td>
                                        {{ i.admin_id }}
                                    </td>
                                    <td>
                                        {{ i.appointment_date }}
                                    </td>
                                    <td>
                                        {{ i.appointment_time }}
                                    </td>
                                    <td>
                                        {{ 'Pending' if i.status == 0 else 'Approved' if i.status == 1 else 'Completed' if i.status == 2 else '' }}
                                    </td>
                                    <td>
                                        <a href="javascript:void(0);" onclick="viewPatient('{{ i.patient_id }}')"><span class="glyphicon glyphicon-eye-open"></span></a>
                                        {% if i.status==0 %}
                                        <a href="#" onclick="approveAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-ok"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==1 %}
                                        <a href="#" onclick="completeAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-bookmark"></span></a>
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% elif i.status==2 %}
                                        <a href="#" onclick="deleteAppointment({{ i.appointment_id }})"><span class="glyphicon glyphicon-trash"></span></a>
                                        {% else %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    document.addEventListener('DOMContentLoaded', function(){
        const statusFilter = document.getElementById('statusFilter');
        const tableContainer = document.getElementById('tableContainer');
        const allTable = document.getElementById('allTable');
        const pendingTable = document.getElementById('pending');
        const approvedTable = document.getElementById('approved');
        const completedTable = document.getElementById('completed');

        // Add event listener to the status filter dropdown
        statusFilter.addEventListener('change', function() {
            const selectedValue = statusFilter.value;

            // Hide all tables
            allTable.style.display = 'none';
            pendingTable.style.display = 'none';
            approvedTable.style.display = 'none';
            completedTable.style.display = 'none';

            // Show the table based on the selected value
            if (selectedValue === 'all') {
                allTable.style.display = 'table';
            } else if (selectedValue === 'pending') {
                pendingTable.style.display = 'table';
            } else if (selectedValue === 'approved') {
                approvedTable.style.display = 'table';
            } else if (selectedValue === 'completed') {
                completedTable.style.display = 'table';
            }
        });
    
    });
    
    function completeAppointment(id){
        if (confirm("Are you sure you want to complete this appointment?")){
            axios.put(`/admin-complete-appointment/${id}`).then(response => {
                console.log(response.message);
                location.reload(true);
            }).catch(error => {
                console.log(error.message);
            });
        } else {}
    }
    
    function approveAppointment(id){
        if (confirm("Are you sure you want to approve this appointment?")){
            axios.put(`/admin-approve-appointment/${id}`).then(response => {
                console.log(response.message);
                location.reload(true);
            }).catch(error => {
                console.log(error.message);
            });
        } else {}
    }
    
    function deleteAppointment(id){
        if (confirm("Are you sure you want to delete this appointment?")){
            axios.delete(`/admin-delete-appointment/${id}`).then(response => {
                if (response.status===201){
                    console.log(response.data.message);
                }else{
                    console.log(response.data)
                }
                location.reload(true);
            }).catch(error => {
                console.log(error.message);
            });
        } else {}
    }


    function viewPatient(id) {
            axios.get(`patient/${id}`)
                .then(response => {
                    // Assuming response.data is the patient object
                    const patient = response.data;

                    // Create HTML content for the modal body
                    const modalBodyContent = `
                        First Name: ${patient.firstname}
                        Last Name: ${patient.lastname}
                        Age: ${patient.age}
                        Gender: ${patient.gender}
                        Contact Number: ${patient.contact_number}
                        Email: ${patient.email}
                        Address: ${patient.address}
                        Treatment: ${patient.treatment}
                    `;

                    // Set modal body content
                    alert(modalBodyContent);
                })
                .catch(error => {
                    alert("Patient already deleted, You may now delete this one as well");
                    console.log(error);
                });
        }
    

</script>

